# turbo-octo-parser

## Описание

Этот сервис позволяет конвертировать PDF-документы в формат Markdown. Сервис реализован на Python и развернут с помощью Docker Compose. Обработка PDF-файлов происходит асинхронно с использованием масштабируемых воркеров, которые выполняют задачи конвертации. Пайплайн конвертации выполнен в модульном виде.

## Содержание

- [Архитектура](#архитектура)
- [Компоненты](#компоненты)
  - [1. API-сервер](#1-api-сервер)
    - [API-эндпоинты](#api-эндпоинты)
  - [2. Обработка](#2-обработка)
  - [3. Масштабируемые воркеры](#3-масштабируемые-воркеры)
  - [4. Логирование](#4-логирование)
  - [5. Настройка Docker Compose](#5-настройка-docker-compose)
- [Запуск сервиса](#запуск-сервиса)
- [Тестирование сервиса](#тестирование-сервиса)
- [Пример PDF и ожидаемый результат](#пример-pdf-и-ожидаемый-результат)
- [Документация](#документация)
- [Репозиторий кода](#репозиторий-кода)

## Архитектура

Сервис состоит из следующих основных компонентов:

- **API-сервер**: Отвечает за обработку HTTP-запросов, прием загрузок PDF-файлов и предоставление статуса задач и результатов.
- **Очередь сообщений (RabbitMQ)**: Управляет асинхронной очередью задач для обработки конвертации PDF.
- **Воркер**: Обрабатывает задачи из очереди с использованием конвейера конвертации.
- **Конвейер обработки**: Ряд шагов (реализованных в виде классов), которые обрабатывают PDF и конвертируют его в Markdown.
- **Логирование**: Ведется журнал для мониторинга и устранения неполадок.
- **Хранилище**: Постоянно хранит загруженные PDF-файлы, конвертированные Markdown-файлы и логи.

## Компоненты

### 1. API-сервер

Для создания API-сервера используется FastAPI.

#### API-эндпоинты

- **POST /convert**
  - Загрузка PDF-файла для конвертации.
  - Возвращает `task_id` для отслеживания статуса.

- **GET /status/{task_id}**
  - Проверка статуса задачи конвертации (ожидание, обработка, завершено, ошибка).

- **GET /result/{task_id}**
  - Получение конвертированного Markdown-файла в виде текстового вложения.

### 2. Обработка

Конвейер обработки состоит из нескольких шагов, которые обрабатывают PDF и конвертируют его в Markdown.

### 3. Масштабируемые воркеры

Воркеры обрабатывают задачи из очереди, используя конвейер конвертации. Их количество можно масштабировать в зависимости от нагрузки.

### 4. Логирование

Ведется журнал для мониторинга и устранения неполадок. Логи хранятся в директории `logs`.

### 5. Настройка Docker Compose

Сервис развернут с использованием Docker Compose, что позволяет легко масштабировать и управлять всеми компонентами.

## Запуск сервиса

### Предварительные требования

- Установленные Docker и Docker Compose на вашем компьютере.

### Шаги

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/yourusername/pdf-to-markdown-service.git
   cd pdf-to-markdown-service
   ```

2. Создайте необходимые директории:

   ```bash
   mkdir data logs
   ```

3. Соберите и запустите сервисы:

   ```bash
   docker-compose up --build
   ```

   Эта команда собирает Docker-образы и запускает все сервисы.

4. Доступ к API:

   API-сервер будет доступен по адресу `http://localhost:8000`.

## Тестирование сервиса

### 1. Загрузка PDF для конвертации

Используйте `curl` или любой инструмент для тестирования API (например, Postman).

```bash
curl -X POST "http://localhost:8000/convert" -F "file=@sample.pdf"
```

Ответ:

```json
{
  "task_id": "your-task-id"
}
```

### 2. Проверка статуса задачи

```bash
curl "http://localhost:8000/status/your-task-id"
```

Возможные ответы:

- `{"status": "pending"}`
- `{"status": "processing"}`
- `{"status": "completed"}`
- `{"status": "failed"}`

### 3. Получение результата

```bash
curl "http://localhost:8000/result/your-task-id" -o output.md
```

Эта команда сохраняет конвертированный Markdown в файл `output.md`.

## Пример PDF и ожидаемый результат

Для тестирования можно использовать предоставленный пример PDF-файла, расположенный в `test/sample.pdf`.

Ожидаемый результат Markdown (так как конвейер использует заглушки):

```markdown
# Dummy Markdown

Dummy text extracted from PDF
```

## Документация

- **API-документация**: Поскольку используется FastAPI, интерактивная документация API доступна по адресу `http://localhost:8000/docs`.
- **Логи**: Проверьте логи в директории `logs` для получения подробной информации и сообщений об ошибках.
- **Хранение данных**: Загруженные PDF-файлы, статусы и результаты хранятся в директории `data`.
